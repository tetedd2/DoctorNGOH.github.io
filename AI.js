// **р╕кр╕│р╕Др╕▒р╕Н: р╣Бр╕Бр╣Йр╣Др╕В URL р╕Щр╕╡р╣Йр╣Гр╕лр╣Йр╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╣Вр╕бр╣Ар╕Фр╕ер╕Вр╕нр╕Зр╕Др╕╕р╕Ур╕Ир╕▓р╕Б Teachable Machine**
// р╕Цр╣Йр╕▓р╕Др╕╕р╕У Upload р╣Вр╕бр╣Ар╕Фр╕ер╣Др╕Ы Cloud:
const URL = "https://teachablemachine.withgoogle.com/models/GAu0Um0vr/";
// р╣Бр╕Чр╕Щ YOUR_MODEL_ID р╕Фр╣Йр╕зр╕в ID р╕Ир╕гр╕┤р╕Зр╣Ж р╕Вр╕нр╕Зр╣Вр╕бр╣Ар╕Фр╕ер╕Др╕╕р╕У р╣Ар╕Кр╣Ир╕Щ "https://teachablemachine.withgoogle.com/models/asdfghjkl/"

// р╕Цр╣Йр╕▓р╕Др╕╕р╕У Download р╣Вр╕бр╣Ар╕Фр╕ер╕бр╕▓р╣Бр╕ер╣Йр╕зр╕зр╕▓р╕Зр╣Др╕зр╣Йр╣Гр╕Щр╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М my-model/:
// const URL = "./my-model/";

let model, webcam, labelContainer, maxPredictions;
let isPredicting = false; // р╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕Ър╕Др╕╕р╕б loop р╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в
const messageElement = document.getElementById('message');
const startButton = document.getElementById('startButton');
const stopButton = document.getElementById('stopButton');
const resultDisplayElement = document.getElementById('resultDisplay'); // р╣Ар╕Юр╕┤р╣Ир╕б Element р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б

// *******************************************************************
// ** р╣Ар╕Юр╕┤р╣Ир╕бр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕кр╕│р╕лр╕гр╕▒р╕Ъ Logic р╕Бр╕▓р╕гр╕Ир╕▒р╕Ър╣Ар╕зр╕ер╕▓р╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Хр╕▓р╕бр╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕В **
// *******************************************************************
let predictionHistory = []; // р╣Ар╕Бр╣Зр╕Ър╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в (р╣Ар╕Кр╣Ир╕Щ 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡р╕ер╣Ир╕▓р╕кр╕╕р╕Ф)
const REQUIRED_CONSISTENCY_TIME_MS = 5000; // 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡
const REQUIRED_PROBABILITY = 0.9; // 90%

// р╣Др╕бр╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щр╕Хр╣Йр╕нр╕Зр╣Гр╕Кр╣Й currentDetectedClass р╣Бр╕ер╕░ detectionStartTime р╣Бр╕ер╣Йр╕з р╣Ар╕Щр╕╖р╣Ир╕нр╕Зр╕Ир╕▓р╕Бр╣Гр╕Кр╣Й predictionHistory р╣Бр╕Чр╕Щ
// let currentDetectedClass = null;
// let detectionStartTime = 0;
// *******************************************************************

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ (р╕Цр╕╣р╕Бр╣Ар╕гр╕╡р╕вр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б")
async function init() {
┬а ┬а messageElement.textContent = 'р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕ер╣Бр╕ер╕░р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Бр╕ер╣Йр╕нр╕З...';
┬а ┬а messageElement.className = 'message';
┬а ┬а startButton.disabled = true; // р╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Start р╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕з
┬а ┬а stopButton.disabled = true; // р╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Stop р╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕зр╣Гр╕Щр╕гр╕░р╕лр╕зр╣Ир╕▓р╕З init
┬а ┬а resultDisplayElement.innerHTML = ''; // р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Ар╕Бр╣Ир╕▓

┬а ┬а // 1. р╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕е
┬а ┬а const modelURL = URL + "model.json";
┬а ┬а const metadataURL = URL + "metadata.json";

┬а ┬а try {
┬а ┬а ┬а ┬а model = await tmImage.load(modelURL, metadataURL);
┬а ┬а ┬а ┬а maxPredictions = model.getTotalClasses(); // р╕Ир╕│р╕Щр╕зр╕Щ Classes р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╣Вр╕бр╣Ар╕Фр╕е
┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а console.error("р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕е:", error);
┬а ┬а ┬а ┬а messageElement.textContent = `р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╣Вр╕бр╣Ар╕Фр╕е: ${error.message}`;
┬а ┬а ┬а ┬а messageElement.className = 'message error';
┬а ┬а ┬а ┬а startButton.disabled = false; // р╣Ар╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Start р╕Бр╕ер╕▒р╕Ър╕бр╕▓
┬а ┬а ┬а ┬а return;
┬а ┬а }

┬а ┬а // 2. р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Webcam
┬а ┬а const flip = true; // р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Гр╕лр╣Йр╕ар╕▓р╕Юр╕Бр╕ер╕▒р╕Ър╕Фр╣Йр╕▓р╕Щр╣Бр╕Щр╕зр╕Щр╕нр╕Щ (р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕ер╣Йр╕нр╕Зр╕лр╕Щр╣Йр╕▓)
┬а ┬а try {
┬а ┬а ┬а ┬а webcam = new tmImage.Webcam(200, 200, flip); // р╕Бр╕зр╣Йр╕▓р╕З, р╕кр╕╣р╕З, р╕Бр╕ер╕▒р╕Ър╕Фр╣Йр╕▓р╕Щ
┬а ┬а ┬а ┬а await webcam.setup(); // р╕Вр╕нр╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╕Бр╕ер╣Йр╕нр╕З
┬а ┬а ┬а ┬а await webcam.play(); // р╣Ар╕гр╕┤р╣Ир╕бр╣Ар╕ер╣Ир╕Щр╕зр╕┤р╕Фр╕╡р╣Вр╕нр╕Ир╕▓р╕Бр╕Бр╕ер╣Йр╕нр╕З

┬а ┬а ┬а ┬а // р╣Ар╕Юр╕┤р╣Ир╕б canvas р╕Вр╕нр╕З webcam р╕ер╕Зр╣Гр╕Щ DOM
┬а ┬а ┬а ┬а document.getElementById("webcam").innerHTML = ''; // р╕ер╣Йр╕▓р╕З div р╕Бр╣Ир╕нр╕Щ
┬а ┬а ┬а ┬а document.getElementById("webcam").appendChild(webcam.canvas);

┬а ┬а ┬а ┬а isPredicting = true; // р╣Ар╕гр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в
┬а ┬а ┬а ┬а window.requestAnimationFrame(loop); // р╣Ар╕гр╕┤р╣Ир╕б loop р╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕е

┬а ┬а } catch (error) {
┬а ┬а ┬а ┬а console.error("р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Бр╕ер╣Йр╕нр╕З:", error);
┬а ┬а ┬а ┬а if (error.name === 'NotAllowedError') {
┬а ┬а ┬а ┬а ┬а ┬а messageElement.textContent = 'р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Гр╕лр╣Йр╣Ар╕Вр╣Йр╕▓р╕Цр╕╢р╕Зр╕Бр╕ер╣Йр╕нр╕З р╕Бр╕гр╕╕р╕Ур╕▓р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕Ър╕гр╕▓р╕зр╣Мр╣Ар╕Лр╕нр╕гр╣Мр╕Вр╕нр╕Зр╕Др╕╕р╕У';
┬а ┬а ┬а ┬а } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
┬а ┬а ┬а ┬а ┬а ┬а messageElement.textContent = 'р╣Др╕бр╣Ир╕Юр╕Ър╕Бр╕ер╣Йр╕нр╕Зр╣Гр╕Щр╕нр╕╕р╕Ыр╕Бр╕гр╕Ур╣Мр╕Вр╕нр╕Зр╕Др╕╕р╕У';
┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а messageElement.textContent = `р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Бр╕ер╣Йр╕нр╕З: ${error.message}`;
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а messageElement.className = 'message error';
┬а ┬а ┬а ┬а startButton.disabled = false; // р╣Ар╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Start р╕Бр╕ер╕▒р╕Ър╕бр╕▓
┬а ┬а ┬а ┬а return;
┬а ┬а }

┬а ┬а // 3. р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в
┬а ┬а labelContainer = document.getElementById("label-container");
┬а ┬а labelContainer.innerHTML = ''; // р╕ер╣Йр╕▓р╕Зр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╣Ар╕Фр╕┤р╕б (р╕Цр╣Йр╕▓р╕бр╕╡)
┬а ┬а for (let i = 0; i < maxPredictions; i++) { // р╕кр╕гр╣Йр╕▓р╕З div р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕ер╕░ Class
┬а ┬а ┬а ┬а labelContainer.appendChild(document.createElement("div"));
┬а ┬а }

┬а ┬а // *******************************************************************
┬а ┬а // ** р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕Ир╕▒р╕Ър╣Ар╕зр╕ер╕▓р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╣Гр╕лр╕бр╣И **
┬а ┬а // *******************************************************************
┬а ┬а predictionHistory = [];
┬а ┬а // *******************************************************************

┬а ┬а messageElement.textContent = 'р╕Юр╕гр╣Йр╕нр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б!';
┬а ┬а messageElement.className = 'message success';
┬а ┬а startButton.disabled = true; // р╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Start
┬а ┬а stopButton.disabled = false; // р╣Ар╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Stop
}

// Loop р╕лр╕ер╕▒р╕Бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕ер╕нр╕вр╣Ир╕▓р╕Зр╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕З
async function loop() {
┬а ┬а if (!isPredicting) return; // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╣Вр╕лр╕бр╕Фр╕Чр╕│р╕Щр╕▓р╕в р╣Гр╕лр╣Йр╕лр╕вр╕╕р╕Ф loop

┬а ┬а webcam.update(); // р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Ар╕Яр╕гр╕бр╕Ир╕▓р╕Бр╕Бр╕ер╣Йр╕нр╕З
┬а ┬а await predict(); // р╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕е
┬а ┬а window.requestAnimationFrame(loop); // р╣Ар╕гр╕╡р╕вр╕Бр╕Хр╕▒р╕зр╣Ар╕нр╕Зр╕Лр╣Йр╕│р╣Ар╕Юр╕╖р╣Ир╕нр╕Чр╕│р╕Лр╣Йр╕│
}

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕е
async function predict() {
┬а ┬а // р╕кр╣Ир╕Зр╣Ар╕Яр╕гр╕бр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Ир╕▓р╕Бр╕Бр╕ер╣Йр╕нр╕З (webcam.canvas) р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╣Вр╕бр╣Ар╕Фр╕ер╣Ар╕Юр╕╖р╣Ир╕нр╕Чр╕│р╕Щр╕▓р╕вр╕Ьр╕е
┬а ┬а const prediction = await model.predict(webcam.canvas);

┬а ┬а // р╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Хр╕▓р╕бр╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕Ир╕▓р╕Бр╕бр╕▓р╕Бр╣Др╕Ыр╕Щр╣Йр╕нр╕в
┬а ┬а prediction.sort((a, b) => b.probability - a.probability);

┬а ┬а let topClassName = ''; // р╣Ар╕Бр╣Зр╕Ър╕Кр╕╖р╣Ир╕н Class р╕Чр╕╡р╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕кр╕╣р╕Зр╕кр╕╕р╕Ф
┬а ┬а let topProbability = 0; // р╣Ар╕Бр╣Зр╕Ър╕Др╣Ир╕▓р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕кр╕╣р╕Зр╕кр╕╕р╕Ф

┬а ┬а // р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
┬а ┬а for (let i = 0; i < maxPredictions; i++) {
┬а ┬а ┬а ┬а const classPrediction = prediction[i].className + ": " + (prediction[i].probability * 100).toFixed(1) + "%";
┬а ┬а ┬а ┬а const predictionDiv = labelContainer.childNodes[i];

┬а ┬а ┬а ┬а if (i === 0) { // Class р╕Чр╕╡р╣Ир╕бр╕╡р╕Др╣Ир╕▓р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╕нр╕вр╕╣р╣Ир╣Ар╕кр╕бр╕н
┬а ┬а ┬а ┬а ┬а ┬а topClassName = prediction[i].className;
┬а ┬а ┬а ┬а ┬а ┬а topProbability = prediction[i].probability;

┬а ┬а ┬а ┬а ┬а ┬а if (topProbability > 0.7) { // р╕Ыр╕гр╕▒р╕Ър╕Др╣Ир╕▓ 0.7 р╣Др╕Фр╣Йр╕Хр╕▓р╕бр╕Др╕зр╕▓р╕бр╣Ар╕лр╕бр╕▓р╕░р╕кр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Др╕ор╣Др╕ер╕Чр╣М
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а predictionDiv.className = 'highlight';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *******************************************************************
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // ** р╕кр╣Ир╕зр╕Щр╕Чр╕╡р╣Ир╣Ар╕Юр╕┤р╣Ир╕б/р╣Бр╕Бр╣Йр╣Др╕Вр╕кр╕│р╕лр╕гр╕▒р╕Ъ Logic р╕Бр╕▓р╕гр╕Ир╕▒р╕Ър╣Ар╕зр╕ер╕▓р╣Бр╕ер╕░р╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Хр╕▓р╕бр╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕В **
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *******************************************************************
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а const currentTime = Date.now();

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕вр╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕ер╕Зр╣Гр╕Щ History (р╣Ар╕Бр╣Зр╕Ър╣Ар╕Йр╕Юр╕▓р╕░р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╣Ир╕▓р╕кр╕╕р╕Фр╕Хр╕▓р╕бр╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г)
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а predictionHistory.push({ className: topClassName, probability: topProbability, time: currentTime });
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Ар╕Бр╣Ир╕▓р╣Ар╕Бр╕┤р╕Щ REQUIRED_CONSISTENCY_TIME_MS р╕нр╕нр╕Бр╣Др╕Ы
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а predictionHistory = predictionHistory.filter(p => currentTime - p.time <= REQUIRED_CONSISTENCY_TIME_MS);

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕Зр╕Вр╕нр╕З Class р╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а let isConsistentAndHighConfidence = true;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (predictionHistory.length > 0) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Чр╕╕р╕Бр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕вр╣Гр╕Щ history р╣Ар╕Ыр╣Зр╕Щ class р╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щр╣Бр╕ер╕░р╕бр╕╡р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕Хр╕▓р╕бр╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Ф
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а for (let p of predictionHistory) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (p.className !== topClassName || p.probability < REQUIRED_PROBABILITY) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а isConsistentAndHighConfidence = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а break;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щ History р╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕нр╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕вр╕░р╣Ар╕зр╕ер╕▓р╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (predictionHistory.length > 0 && (predictionHistory[predictionHistory.length - 1].time - predictionHistory[0].time) < REQUIRED_CONSISTENCY_TIME_MS) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а isConsistentAndHighConfidence = false;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а isConsistentAndHighConfidence = false; // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╣Зр╣Др╕бр╣Ир╕Цр╕╖р╕нр╕зр╣Ир╕▓ Consistent
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // Logic р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Юр╕┤р╣Ар╕ир╕й (D1, D2, D3, D4, D5 ) р╣Бр╕ер╕░р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (isConsistentAndHighConfidence) {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.className = 'important-message';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (topClassName === "D2") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h3>ЁЯЪи р╣Ар╕Ыр╣Зр╕Щр╣Вр╕гр╕Др╕Ир╕╕р╕Фр╕гр╕▓р╕Вр╕▓р╕з ЁЯЪи</h3>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а stopCamera(); // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "D1") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h3>тЬЕ р╕Ыр╕ер╕нр╕Фр╣Ар╕Кр╕╖р╣Йр╕нр╣Вр╕гр╕Д тЬЕ</h3>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а stopCamera(); // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "D3") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h3>ЁЯЪи р╣Ар╕Ыр╣Зр╕Щр╣Вр╕гр╕Др╕кр╕Щр╕┤р╕б ЁЯЪи</h3>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а stopCamera(); // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "D4") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h3>ЁЯЪи р╣Ар╕Ыр╣Зр╕Щр╣Вр╕гр╕Др╣Гр╕Ър╣Др╕лр╕бр╣Й ЁЯЪи</h3>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а stopCamera(); // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "D5") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h3>ЁЯЪи р╕Бр╕гр╕╕р╕Ур╕▓р╕Цр╣Ир╕▓р╕вр╣Гр╕лр╕бр╣И ЁЯЪи</h3>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а stopCamera(); // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Цр╣Йр╕▓р╣Ар╕Ыр╣Зр╕Щ Class р╕нр╕╖р╣Ир╕Щр╣Ж р╕Чр╕╡р╣Ир╣Ар╕Вр╣Йр╕▓р╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕В 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ 90% р╣Бр╕Хр╣Ир╣Др╕бр╣Ир╣Гр╕Кр╣И D1/D2
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = `<h4>ЁЯТб р╣Вр╕бр╣Ар╕Фр╕ер╕бр╕▒р╣Ир╕Щр╣Гр╕Ир╣Гр╕Щ "${topClassName}" р╕бр╕▓р╕Бр╕Бр╕зр╣Ир╕▓ 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡!</h4><p>р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щ: ${ (topProbability * 100).toFixed(1)}%</p>`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.className = 'info-message';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Хр╕гр╕Зр╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕В 5 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ 90% р╕Бр╣Зр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Ыр╕Бр╕Хр╕┤р╕Вр╕нр╕Зр╕Др╕╕р╕У
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.className = ''; // р╕ер╣Йр╕▓р╕З class р╕Бр╣Ир╕нр╕Щ
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а if (topClassName === "Dog") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h4>ЁЯР╢ р╕Щр╕╡р╣Ир╕Др╕╖р╕нр╕кр╕╕р╕Щр╕▒р╕В!</h4><p>р╕кр╕╕р╕Щр╕▒р╕Вр╣Ар╕Ыр╣Зр╕Щр╕кр╕▒р╕Хр╕зр╣Мр╣Ар╕ер╕╡р╣Йр╕вр╕Зр╕Чр╕╡р╣Ир╕Лр╕╖р╣Ир╕нр╕кр╕▒р╕Хр╕вр╣Мр╣Бр╕ер╕░р╕Йр╕ер╕▓р╕Ф!</p>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "Cat") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h4>ЁЯР▒ р╕Щр╕╡р╣Ир╕Др╕╖р╕нр╣Бр╕бр╕з!</h4><p>р╣Бр╕бр╕зр╣Ар╕Ыр╣Зр╕Щр╕кр╕▒р╕Хр╕зр╣Мр╣Ар╕ер╕╡р╣Йр╕вр╕Зр╕Чр╕╡р╣Ир╕Щр╣Ир╕▓р╕гр╕▒р╕Бр╣Бр╕ер╕░р╕гр╕▒р╕Бр╕нр╕┤р╕кр╕гр╕░!</p>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "Chair") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h4>ЁЯкС р╕Щр╕╡р╣Ир╕Др╕╖р╕нр╣Ар╕Бр╣Йр╕▓р╕нр╕╡р╣Й!</h4><p>р╣Ар╕Бр╣Йр╕▓р╕нр╕╡р╣Йр╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Щр╕▒р╣Ир╕Зр╕Юр╕▒р╕Бр╕Ьр╣Ир╕нр╕Щр╕лр╕гр╕╖р╕нр╕Чр╕│р╕Зр╕▓р╕Щ</p>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а } else if (topClassName === "Table") {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = "<h4>р╣Вр╕Хр╣Кр╕░!</h4><p>р╣Вр╕Хр╣Кр╕░р╣Ар╕Ыр╣Зр╕Щр╣Ар╕Яр╕нр╕гр╣Мр╕Щр╕┤р╣Ар╕Ир╕нр╕гр╣Мр╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ър╕зр╕▓р╕Зр╕кр╕┤р╣Ир╕Зр╕Вр╕нр╕Зр╕лр╕гр╕╖р╕нр╕Чр╕│р╕Зр╕▓р╕Щ</p>";
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *** р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Юр╕┤р╣Ир╕б `else if` р╣Др╕Фр╣Йр╣Ар╕гр╕╖р╣Ир╕нр╕вр╣Ж р╕кр╕│р╕лр╕гр╕▒р╕Ъ Class р╕нр╕╖р╣Ир╕Щр╣Ж р╣Гр╕Щр╣Вр╕бр╣Ар╕Фр╕ер╕Вр╕нр╕Зр╕Др╕╕р╕У ***
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а else {
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = `<p>р╕Бр╕│р╕ер╕▒р╕Зр╕гр╕нр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б... (р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕кр╕╣р╕Зр╕Юр╕н р╕лр╕гр╕╖р╕нр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕Хр╣Ир╕нр╣Ар╕Щр╕╖р╣Ир╕нр╕З)</p>`;
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.className = 'info-message';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *******************************************************************
┬а ┬а ┬а ┬а ┬а ┬а } else { // р╕Цр╣Йр╕▓р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕кр╕╣р╕Зр╕кр╕╕р╕Фр╣Др╕бр╣Ир╕Цр╕╢р╕Зр╣Ар╕Бр╕Ур╕Ср╣Мр╕Чр╕╡р╣Ир╕Хр╕▒р╣Йр╕Зр╣Др╕зр╣Й
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а predictionDiv.className = '';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.innerHTML = '<p>р╕Бр╕│р╕ер╕▒р╕Зр╕гр╕нр╕Бр╕▓р╕гр╕Ир╕│р╣Бр╕Щр╕Б... (р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕кр╕╣р╕Зр╕Юр╕н)</p>';
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а resultDisplayElement.className = 'info-message';

┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *******************************************************************
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // ** р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕Ир╕▒р╕Ър╣Ар╕зр╕ер╕▓р╣Ар╕бр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╣Др╕бр╣Ир╕Цр╕╢р╕Зр╣Ар╕Бр╕Ур╕Ср╣М **
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *******************************************************************
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а predictionHistory = [];
┬а ┬а ┬а ┬а ┬а ┬а ┬а ┬а // *******************************************************************
┬а ┬а ┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а } else {
┬а ┬а ┬а ┬а ┬а ┬а predictionDiv.className = '';
┬а ┬а ┬а ┬а }
┬а ┬а ┬а ┬а predictionDiv.innerHTML = classPrediction;
┬а ┬а }
}

// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕Бр╕ер╣Йр╕нр╕Зр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в
async function stopCamera() {
┬а ┬а isPredicting = false; // р╕лр╕вр╕╕р╕Ф loop р╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в (р╕кр╕│р╕Др╕▒р╕Нр╕бр╕▓р╕Б)
┬а ┬а if (webcam) {
┬а ┬а ┬а ┬а webcam.stop(); // р╕лр╕вр╕╕р╕Фр╕Бр╕ер╣Йр╕нр╕Зр╕Ир╕гр╕┤р╕З р╣Ж
┬а ┬а ┬а ┬а // р╕ер╣Йр╕▓р╕З canvas р╕Вр╕нр╕Зр╕Бр╕ер╣Йр╕нр╕З
┬а ┬а ┬а ┬а const webcamDiv = document.getElementById("webcam");
┬а ┬а ┬а ┬а if (webcamDiv) {
┬а ┬а ┬а ┬а ┬а ┬а webcamDiv.innerHTML = '<p>р╕Бр╕ер╣Йр╕нр╕Зр╕лр╕вр╕╕р╕Фр╕Чр╕│р╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з</p>'; // р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╕кр╕Цр╕▓р╕Щр╕░
┬а ┬а ┬а ┬а }
┬а ┬а }
┬а ┬а labelContainer.innerHTML = ''; // р╕ер╣Йр╕▓р╕Зр╕Ьр╕ер╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в
┬а ┬а // resultDisplayElement.innerHTML = ''; // р╣Др╕бр╣Ир╕ер╣Йр╕▓р╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М D1/D2 р╕Чр╕┤р╣Йр╕Зр╕Чр╕▒р╕Щр╕Чр╕╡ р╣Бр╕Хр╣Ир╣Гр╕лр╣Йр╕Др╕Зр╣Др╕зр╣Й
┬а ┬а messageElement.textContent = 'р╕Бр╕ер╣Йр╕нр╕Зр╣Бр╕ер╕░р╣Вр╕бр╣Ар╕Фр╕ер╕лр╕вр╕╕р╕Фр╕Чр╕│р╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з'; // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕кр╕Цр╕▓р╕Щр╕░р╕лр╕ер╕▒р╕Б
┬а ┬а messageElement.className = 'message';
┬а ┬а startButton.disabled = false; // р╣Ар╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Start
┬а ┬а stopButton.disabled = true; // р╕Ыр╕┤р╕Фр╕Ыр╕╕р╣Ир╕б Stop

┬а ┬а // *******************************************************************
┬а ┬а // ** р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕Ир╕▒р╕Ър╣Ар╕зр╕ер╕▓р╣Ар╕бр╕╖р╣Ир╕нр╕лр╕вр╕╕р╕Фр╕Бр╕ер╣Йр╕нр╕З **
┬а ┬а // *******************************************************************
┬а ┬а predictionHistory = [];
┬а ┬а // *******************************************************************
}

// р╣Ар╕Юр╕┤р╣Ир╕б Event Listener р╣Гр╕лр╣Йр╕Бр╕▒р╕Ър╕Ыр╕╕р╣Ир╕б
startButton.addEventListener('click', init); // р╕Др╕ер╕┤р╕Б Start -> р╣Ар╕гр╕╡р╕вр╕Б init()
stopButton.addEventListener('click', stopCamera); // р╕Др╕ер╕┤р╕Б Stop -> р╣Ар╕гр╕╡р╕вр╕Б stopCamera()

// р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Ар╕бр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ р╣Гр╕лр╣Йр╕лр╕вр╕╕р╕Фр╕Бр╕ер╣Йр╕нр╕З
window.addEventListener('beforeunload', () => {
┬а ┬а if (webcam) {
┬а ┬а ┬а ┬а webcam.stop();
┬а ┬а }
});