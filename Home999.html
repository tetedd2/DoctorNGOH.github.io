<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡πÄ‡∏Å‡∏©‡∏ï‡∏£ Now + AI</title>

  <!-- ==== (‡∏Ñ‡∏á‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ) ==== -->
  <!-- ‚¨á‚¨á‚¨á ‡∏ß‡∏≤‡∏á <link> css ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Navbar / Chat Widget) ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‚¨á‚¨á‚¨á -->

  <style>
    :root{--bg:#f5f7fb;--card:#fff;--text:#1f2937;--muted:#6b7280;--brand:#10b981;--brand2:#3b82f6;--radius:18px;--shadow:0 8px 24px rgba(0,0,0,.06)}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-rounded,"Segoe UI",system-ui,-apple-system,"Kanit",sans-serif}

    /* ===== ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà ===== */
    header.appbar{position:sticky;top:0;background:rgba(245,247,251,.8);backdrop-filter:blur(8px);border-bottom:1px solid #eee;z-index:20}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 20px}
    .hello{display:inline-flex;align-items:center;gap:10px;background:var(--card);padding:10px 14px;border-radius:999px;box-shadow:var(--shadow);border:1px solid #eee;font-weight:600}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:22px;max-width:1100px;margin:0 auto;padding:18px 20px 60px}
    .card{grid-column:span 4;background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;border:1px solid #eee}
    .big{grid-column:span 8}
    @media(max-width:980px){.card{grid-column:span 6}.big{grid-column:span 12}}
    @media(max-width:680px){.card{grid-column:span 12}}

    .title{display:flex;align-items:center;gap:10px;font-weight:800;font-size:18px;margin-bottom:8px}
    .badge{margin-left:auto;font-size:12px;color:#fff;background:#16a34a;padding:2px 8px;border-radius:999px}
    .rows{display:flex;flex-direction:column;gap:6px}
    .muted{color:var(--muted)}
    .divider{height:1px;background:#eee;margin:12px 0}
    .stack{display:flex;gap:10px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;background:#f1f5f9;border-radius:999px;font-size:12px}
    input,button,select,textarea{font:inherit;border-radius:12px;border:1px solid #e5e7eb;padding:10px 12px;background:#fff}
    button{background:var(--brand2);color:#fff;border:none;font-weight:700;cursor:pointer}
    button.ghost{background:#eef2ff;color:#374151}
    .btn-link{background:#eef2ff;color:#1f2937;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-weight:600;cursor:pointer}
    textarea{min-height:90px;width:100%}
    .list{display:flex;flex-direction:column;gap:10px}
/* === Chat Assistant (Floating) === */
.chat-btn{
  position:fixed; right:20px; bottom:90px;  /* 90px ‡∏Å‡∏±‡∏ô‡∏ä‡∏ô‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á */
  width:60px; height:60px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  background:linear-gradient(135deg,#18fc4a 0%,#98eb87 100%);
  color:#fff; font-size:24px; border:none; cursor:pointer;
  box-shadow:0 12px 28px rgba(0,0,0,.18); z-index:1001;
  transition:transform .15s ease;
}
.chat-btn:hover{ transform:translateY(-2px) scale(1.03) }

.chat-box{
  position:fixed; right:20px; bottom:160px;  /* ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏ñ‡∏ö‡∏•‡πà‡∏≤‡∏á */
  width:320px; height:450px; background:#fff; border-radius:16px;
  box-shadow:0 18px 48px rgba(0,0,0,.18); overflow:hidden; display:none; z-index:1000;
}
.chat-box.show{ display:flex; flex-direction:column; }

.chat-header{ background:#e8ffe9; color:#14532d; padding:12px 14px; font-weight:700 }
.chat-body{ flex:1; padding:12px; overflow:auto; background:#fbfbfb }
.chat-footer{ display:flex; gap:8px; padding:10px; background:#fff; border-top:1px solid #eee }
.chat-footer textarea{ flex:1; resize:none; border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; font:inherit }

.msg{ max-width:80%; margin:8px 0; padding:8px 10px; border-radius:14px; font-size:14px }
.msg.ai{ background:#eef2ff; color:#111827; border-bottom-left-radius:6px }
.msg.me{ background:#22c55e; color:#fff; margin-left:auto; border-bottom-right-radius:6px }

    /* clamp */
    .clamp{display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden}
    .clamp-3{-webkit-line-clamp:3}
    .clamp-6{-webkit-line-clamp:6}

    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .tr{display:grid;grid-template-columns:1.2fr .8fr .8fr;gap:10px;align-items:center;background:#f8fafc;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px}
    .tr b{font-size:16px}
    .chip{font-size:12px;background:#e2e8f0;border-radius:999px;padding:2px 8px}

    /* ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î */
    body.compact .card{ padding:14px }
    body.compact .title{ font-size:16px }
    body.compact .rows, body.compact .list{ gap:6px }
    body.compact input, body.compact button, body.compact select, body.compact textarea{ padding:8px 10px; border-radius:10px; font-size:14px }

    /* ‡∏Ç‡πà‡∏≤‡∏ß: ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô + ‡∏Å‡∏£‡∏¥‡∏î 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    .news-wrap{ max-height:520px; overflow:auto; padding-right:6px }
    .news-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px }
    @media (max-width:980px){ .news-grid{ grid-template-columns:1fr } }
    .news-item{ background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px; display:flex; gap:8px; align-items:flex-start }
    .news-title{ font-weight:700 }
    .news-desc{ color:#6b7280; font-size:13px }
    .news-controls{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px }
    .news-wrap::-webkit-scrollbar{ width:8px }
    .news-wrap::-webkit-scrollbar-thumb{ background:#e5e7eb; border-radius:99px }

    /* ‡πÅ‡∏ñ‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + bullet summary */
    .news-toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:10px }
    .news-summary{ background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:10px 12px }
    .hl{ background:#fde68a }
    .button-container-bottom {
    position: fixed;
    bottom: 0;
    left: 0; /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà */
    width: 100%; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
    display: flex;
    justify-content: space-around; /* ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô */
    gap: 10px; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
    background-color: white;
    padding: 8px 0;
    box-shadow: 0 -2px 6px rgba(0, 0, 0, 0.1);
    z-index: 1000;
}

.btn-bottom {
    background-color: transparent; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ */
    border: none;                 /* ‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö */
    cursor: pointer;
    flex: 1;                     /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
    height: 60px;                /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    padding: 0;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: none;             /* ‡∏•‡∏ö‡πÄ‡∏á‡∏≤ */
}

.btn-bottom img {
    width: 80px;                 /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
    height: auto;
    object-fit: contain;
    display: block;
}

.btn-bottom:hover {
    transform: scale(1.05);
}

.btn-bottom:active {
    transform: scale(0.98);
}
        /* ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏•‡πà‡∏≤‡∏á */
        
        .btn-bottom.home {
            background-color: #ffffff;
        }
        
        .btn-bottom.ai {
            background-color: #ffffff;
        }
        
        .btn-bottom.plant {
            background-color: #ffffff;
        }
        
        .btn-bottom.menu {
            background-color: #ffffff;
        }
        
        .btn-bottom {
            background-color: white;
            color: #333;
            padding: 0;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 0;
            box-shadow: none;
        }
        
        .btn-bottom img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .btn-bottom:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        
        .btn-bottom:active {
            transform: scale(0.98);
        }
        
        .btn-bottom.home {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-bottom.ai {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-bottom.plant {
            background-color: #007bff;
            color: white;
        }
        
        .btn-bottom.menu {
            background-color: #ff9900;
            color: white;
        }
  </style>
</head>
<body>

  <!-- ===== (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) ‡πÅ‡∏ñ‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì =====
       ‡∏ß‡∏≤‡∏á <nav> ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤)
  -->
  <!-- <nav> ... ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ... </nav> -->

  <!-- ===== ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡∏ä‡∏ô navbar ‡πÄ‡∏î‡∏¥‡∏°) ===== -->
  <header class="appbar">
    <div class="wrap">
      <div class="hello">
        üëãüèª ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£!
        <span class="pill"><span id="clock">--:--</span> ‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ <span id="today"></span></span>
        <button id="compactBtn" class="btn-link" style="margin-left:12px">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î</button>
      </div>
    </div>
  </header>

  <!-- ===== ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà ===== -->
  <main class="grid" id="appContent">
    <!-- ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏•‡πÑ‡∏°‡πâ -->
    <section class="card" id="priceCard">
      <div class="title">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏•‡πÑ‡∏°‡πâ <span class="badge" id="priceBadge">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span></div>
      <div class="rows">
        <div class="muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πà‡∏≤‡∏ß ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ</div>
        <div id="priceTable" class="list"></div>
      </div>
      <div class="divider"></div>
      <div class="stack">
        <input id="pName" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡∏≤‡∏á‡∏™‡∏≤‡∏î" />
        <input id="pPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏Å‡∏Å." />
        <button onclick="addPrice()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>
    </section>

    <!-- ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ -->
    <section class="card">
      <div class="title">üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£ (‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‚Ä¢ ‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î ‚Ä¢ ‡πÄ‡∏á‡∏≤‡∏∞)</div>

      <div class="news-toolbar">
        <input id="newsSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏Ç‡πà‡∏≤‡∏ß (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏Ñ‡∏≤, ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï, ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)" style="min-width:280px" />
        <span class="muted" id="newsCount">‚Äî</span>
      </div>
      <div id="newsSummary" class="news-summary muted">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß</div>

      <div id="newsScroll" class="news-wrap">
        <div id="newsList" class="news-grid"><div class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πà‡∏≤‡∏ß‚Ä¶</div></div>
      </div>
      <div id="newsControls" class="news-controls"></div>
    </section>

    <!-- ‡∏≠‡∏≤‡∏Å‡∏≤‡∏® + ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
    <section class="card big">
      <div class="title">üå§Ô∏è ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏® <span class="badge" id="placeBadge">‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‚Ä¶</span></div>
      <div class="rows">
        <div>üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: <b id="temp">--</b>¬∞C</div>
        <div>‚òÅÔ∏è ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®: <span id="desc" class="muted">--</span></div>
        <div>üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: <b id="rh">--</b>%</div>
        <div>‚òî ‡∏ù‡∏ô 3 ‡∏ä‡∏°.: <b id="rain">--</b> ‡∏°‡∏°.</div>
      </div>
      <div class="divider"></div>
      <div class="stack">
        <input id="hfKey" type="password" placeholder="HF Token (hf_‚Ä¶)" style="min-width:280px" autocomplete="off" />
        <button onclick="aggregateNow()">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</button>
        <button class="ghost" onclick="saveKey()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Token (‡∏ã‡πà‡∏≠‡∏ô)</button>
      </div>
    </section>
<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏ó‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI -->
<button class="chat-btn" id="chatBtn" aria-label="‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢">üí¨</button>

<!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI -->
<div class="chat-box" id="chatBox" role="dialog" aria-label="‡πÅ‡∏ä‡∏ó‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI">
  <div class="chat-header">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI</div>
  <div class="chat-body" id="chatBody">
    <div class="msg ai">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞/‡∏Ñ‡∏£‡∏±‡∏ö ‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üôå</div>
  </div>
  <div class="chat-footer">
    <textarea id="chatInput" rows="1" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°... (‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á)"></textarea>
    <button id="chatSend">‡∏™‡πà‡∏á</button>
  </div>
</div>

     <div class="button-container-bottom">
        <a href="Home999.html" class="btn-bottom">
            <img src="60.png" alt="Home" />
        </a>
        <a href="Home.html" class="btn-bottom">
            <img src="61.png" alt="AI" />
        </a>
        <a href="Home555.html" class="btn-bottom">
            <img src="62.png" alt="‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏•‡∏π‡∏Å" />
        </a>
        <a href="menu.html" class="btn-bottom">
            <img src="1000.png" alt="MENU" />
        </a>
    </div>
    <!-- AI Summary -->
    <section class="card big">
      <div class="title">üß† ‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏î‡∏¢ AI (Ling-1T) <span class="badge">‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ</span></div>
      <div id="aiBox" class="list"><div class="muted">‡∏Å‡∏î ‚Äú‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</div></div>
    </section>
  </main>

  <!-- ===== (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) ‡∏ß‡∏¥‡∏î‡πÄ‡∏à‡πá‡∏ï‡πÅ‡∏ä‡∏ó AI ‡πÄ‡∏î‡∏¥‡∏° (‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏°‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á) =====
       ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏õ‡∏∏‡πà‡∏°/iframe/‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÅ‡∏ä‡∏ó‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ‡∏ó‡πâ‡∏≤‡∏¢ <body> ‡∏ô‡∏µ‡πâ
       ‡πÄ‡∏ä‡πà‡∏ô <div id="chat-widget">...</div> ‡∏´‡∏£‡∏∑‡∏≠ <script src="..."></script>
  -->
  <!-- <div class="chat-floating"> ... ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ... </div> -->

<script>
    // === Chat Assistant logic ===
const chatBtn  = document.getElementById('chatBtn');
const chatBox  = document.getElementById('chatBox');
const chatBody = document.getElementById('chatBody');
const chatIn   = document.getElementById('chatInput');
const chatSend = document.getElementById('chatSend');

function toggleChat(){
  const show = !chatBox.classList.contains('show');
  chatBox.classList.toggle('show', show);
  if(show){ chatIn.focus(); }
}
chatBtn.addEventListener('click', toggleChat);

function appendMsg(who, text){
  const el = document.createElement('div');
  el.className = `msg ${who}`;
  el.textContent = text;
  chatBody.appendChild(el);
  chatBody.scrollTop = chatBody.scrollHeight;
}

async function handleSend(){
  const text = (chatIn.value || '').trim();
  if(!text) return;
  appendMsg('me', text);
  chatIn.value = '';

  // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏à‡∏£‡∏¥‡∏á ‚Äî ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
  // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ API ‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô backend ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà key ‡∏ù‡∏±‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
  appendMsg('ai', '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ú‡∏°‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡∏∏‡∏õ/‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏´‡πâ (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)‚Äù ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢) ‚úÖ');
}

chatSend.addEventListener('click', handleSend);
chatIn.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    handleSend();
  }
});

/* === Utils & UI === */
const $ = s=>document.querySelector(s);
const pad = n=>String(n).padStart(2,'0');
function setClock(){const d=new Date();$('#clock').textContent=`${pad(d.getHours())}:${pad(d.getMinutes())}`;$('#today').textContent=d.toLocaleDateString('th-TH',{weekday:'long',day:'2-digit',month:'short',year:'numeric'})}
setClock(); setInterval(setClock,3e4);

function codeToDesc(c){const m={0:'‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡πÉ‡∏™',1:'‡∏°‡∏µ‡πÄ‡∏°‡∏Ü‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô',2:'‡∏Ñ‡∏£‡∏∂‡πâ‡∏°',3:'‡πÄ‡∏°‡∏Ü‡∏°‡∏≤‡∏Å',45:'‡∏´‡∏°‡∏≠‡∏Å',51:'‡∏ù‡∏ô‡∏õ‡∏£‡∏≠‡∏¢',61:'‡∏ù‡∏ô‡πÄ‡∏ö‡∏≤',63:'‡∏ù‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',65:'‡∏ù‡∏ô‡∏´‡∏ô‡∏±‡∏Å',95:'‡∏û‡∏≤‡∏¢‡∏∏‡∏ù‡∏ô‡∏ü‡πâ‡∏≤‡∏Ñ‡∏∞‡∏ô‡∏≠‡∏á'};return m[c]||'‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô'}
function seasonTH(m){ if(m>=5&&m<=10) return '‡∏ù‡∏ô'; if(m===3||m===4) return '‡∏£‡πâ‡∏≠‡∏ô'; return '‡∏´‡∏ô‡∏≤‡∏ß'; }
function setLoading(on){ document.querySelectorAll('button').forEach(b=>b.disabled=!!on); if(on) $('#aiBox').innerHTML='<div>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‚Ä¶</div>'; }

/* ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î */
(function initCompact(){
  const saved = localStorage.getItem('COMPACT_MODE') === '1';
  document.body.classList.toggle('compact', saved);
  const btn = document.getElementById('compactBtn');
  if(btn){
    btn.textContent = saved ? '‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥' : '‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î';
    btn.onclick = ()=>{
      const on = !document.body.classList.contains('compact');
      document.body.classList.toggle('compact', on);
      localStorage.setItem('COMPACT_MODE', on ? '1' : '0');
      btn.textContent = on ? '‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏Å‡∏ï‡∏¥' : '‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î';
    };
  }
})();

/* Token (‡∏ã‡πà‡∏≠‡∏ô) */
(function initKey(){ const saved=localStorage.getItem('HF_TOKEN'); if(saved){ const k=document.getElementById('hfKey'); k.value='‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; k.dataset.masked='1'; }})();
function saveKey(){
  const inp=document.getElementById('hfKey');
  const val = (inp.dataset.masked==='1') ? null : inp.value.trim();
  if(val && !val.startsWith('hf_')) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡πÄ‡∏Ñ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ hf_');
  if(val) localStorage.setItem('HF_TOKEN',val);
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡∏ã‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)');
  inp.value='‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢'; inp.dataset.masked='1';
}
function readToken(){
  const inp=document.getElementById('hfKey');
  if(inp.dataset.masked==='1') return localStorage.getItem('HF_TOKEN')||'';
  return inp.value.trim();
}

/* Weather */
async function getWeatherByCoords(lat,lon){
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code&hourly=precipitation&forecast_days=1&timezone=auto`;
  const r=await fetch(url); const j=await r.json();
  const cur=j.current, h=j.hourly;
  const nowHour=new Date().toISOString().slice(0,13);
  const idx=h.time.findIndex(t=>t.startsWith(nowHour));
  let sum=0; for(let i=idx;i<Math.min(idx+3,h.precipitation.length);i++){ sum+=h.precipitation[i]||0; }
  return { temp:cur.temperature_2m, rh:cur.relative_humidity_2m, desc:codeToDesc(cur.weather_code), rain:+sum.toFixed(1) };
}
function renderWeather(wx,label){
  document.getElementById('temp').textContent=wx.temp;
  document.getElementById('rh').textContent=wx.rh;
  document.getElementById('rain').textContent=wx.rain;
  document.getElementById('desc').textContent=wx.desc;
  document.getElementById('placeBadge').textContent=label;
}

/* Province (reverse geocode) */
async function getProvinceTH(lat, lon){
  try{
    const url=`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=th&format=json`;
    const r=await fetch(url); const j=await r.json();
    const p=j?.results?.[0];
    return p?.admin1 || p?.name || '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô';
  }catch{ return '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'; }
}

/* News (grid + search + summary + pagination) */
async function fetchNewsTop(kw, max=10){
  const rss=`https://news.google.com/rss/search?q=${encodeURIComponent(kw)}&hl=th&gl=TH&ceid=TH:th`;
  const api=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rss)}`;
  const r=await fetch(api); const j=await r.json();
  if(!j?.items) return [];
  return j.items.slice(0,max).map(x=>({title:x.title,pubDate:x.pubDate,link:x.link,desc:x.description||''}));
}
let _newsAll = [];
let _newsQuery = '';
function markHL(text,q){
  if(!q) return text;
  try{ const re=new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'ig'); return text.replace(re,'<span class="hl">$1</span>'); }
  catch{ return text; }
}
function newsItemHTML(item,i){
  const d=new Date(item.pubDate).toLocaleDateString('th-TH',{day:'2-digit',month:'short'}); const id=`news${i}`;
  const clean=(item.desc||'').replace(/<[^>]*>/g,'').trim();
  return `<div class="news-item"><i>üü¢</i><div style="flex:1">
    <div class="news-title clamp clamp-2">${markHL(item.title,_newsQuery)}</div>
    <div id="${id}" class="news-desc clamp clamp-2" style="margin-top:4px">${markHL(clean,_newsQuery)}</div>
    <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn-link" onclick="toggleClamp('${id}')">‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>
      <a class="btn-link" href="${item.link}" target="_blank" rel="noopener">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ç‡πà‡∏≤‡∏ß</a>
    </div>
    <div class="muted" style="margin-top:4px">${d}</div></div></div>`;
}
function toggleClamp(id){
  const el=document.getElementById(id); if(!el) return;
  if(el.classList.contains('clamp-2')) el.classList.replace('clamp-2','clamp-6');
  else if(el.classList.contains('clamp-6')) el.classList.remove('clamp');
  else el.classList.add('clamp','clamp-2');
}
const NEWS_PAGE_SIZE=10;
function getFilteredNews(){ if(!_newsQuery) return _newsAll; const q=_newsQuery.toLowerCase(); return _newsAll.filter(n=> (n.title+' '+(n.desc||'')).toLowerCase().includes(q)); }
function renderNewsSummary(items){
  const counts={‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:0,‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î:0,‡πÄ‡∏á‡∏≤‡∏∞:0}; const upW=/(‡∏û‡∏∏‡πà‡∏á|‡πÄ‡∏û‡∏¥‡πà‡∏°|‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô|‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô|‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô)/; const downW=/(‡∏•‡∏î|‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏á|‡∏£‡πà‡∏ß‡∏á|‡∏ï‡πà‡∏≥‡∏•‡∏á)/; const price=/(\d{2,4})\s*‡∏ö‡∏≤‡∏ó/;
  let up=[],down=[],prices={‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:[],‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î:[],‡πÄ‡∏á‡∏≤‡∏∞:[]};
  items.forEach(x=>{ const t=x.title, d=(x.desc||'');
    ['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô','‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î','‡πÄ‡∏á‡∏≤‡∏∞'].forEach(f=>{ if((t+d).includes(f)) counts[f]++; });
    if(upW.test(t)||upW.test(d)) up.push(t); if(downW.test(t)||downW.test(d)) down.push(t);
    ['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô','‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î','‡πÄ‡∏á‡∏≤‡∏∞'].forEach(f=>{ if((t+d).includes(f)){ const m=(t.match(price)||d.match(price)); if(m) prices[f].push(+m[1]); }});
  });
  const avg=a=>a.length?Math.round(a.reduce((x,y)=>x+y,0)/a.length):null;
  document.getElementById('newsSummary').innerHTML=[
    `‚Ä¢ ‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${items.length} ‡∏ä‡∏¥‡πâ‡∏ô ‚ñ∏ ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${counts['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô']||0} | ‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î ${counts['‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î']||0} | ‡πÄ‡∏á‡∏≤‡∏∞ ${counts['‡πÄ‡∏á‡∏≤‡∏∞']||0}`,
    `‚Ä¢ ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ñ‡∏≥‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ ‚ñ∏ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ${up.length} | ‡∏•‡∏î‡∏•‡∏á ${down.length}`,
    `‚Ä¢ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì): ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${avg(prices['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'])?avg(prices['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'])+' ‡∏ö./‡∏Å‡∏Å.':'‚Äî'}, ‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î ${avg(prices['‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î'])?avg(prices['‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î'])+' ‡∏ö./‡∏Å‡∏Å.':'‚Äî'}, ‡πÄ‡∏á‡∏≤‡∏∞ ${avg(prices['‡πÄ‡∏á‡∏≤‡∏∞'])?avg(prices['‡πÄ‡∏á‡∏≤‡∏∞'])+' ‡∏ö./‡∏Å‡∏Å.':'‚Äî'}`
  ].join('<br>');
  document.getElementById('newsSummary').classList.remove('muted');
}
function renderNewsPage(page=1){
  const grid=document.getElementById('newsList'); const ctr=document.getElementById('newsControls');
  const data=getFilteredNews(); const start=(page-1)*NEWS_PAGE_SIZE; const items=data.slice(start,start+NEWS_PAGE_SIZE);
  grid.innerHTML=items.map((it,i)=>newsItemHTML(it,start+i)).join('') || '<div class="muted">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß</div>';
  renderNewsSummary(data); document.getElementById('newsCount').textContent=`‡∏û‡∏ö ${data.length} ‡∏Ç‡πà‡∏≤‡∏ß`;
  const total=data.length, pages=Math.ceil(total/NEWS_PAGE_SIZE)||1;
  ctr.innerHTML=`<span class="muted" style="align-self:center">‡∏´‡∏ô‡πâ‡∏≤ ${Math.min(page,pages)}/${pages}</span>
    ${page>1?`<button class="btn-link" onclick="renderNewsPage(${page-1})">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>`:''}
    ${page<pages?`<button class="btn-link" onclick="renderNewsPage(${page+1})">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>`:''}
    ${total>0?`<button class="btn-link" onclick="renderAllNews()">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>`:''}`;
}
function renderAllNews(){
  const data=getFilteredNews();
  document.getElementById('newsList').innerHTML=data.map((it,i)=>newsItemHTML(it,i)).join('');
  document.getElementById('newsControls').innerHTML=`<button class="btn-link" onclick="renderNewsPage(1)">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ 1</button>`;
  renderNewsSummary(data); document.getElementById('newsCount').textContent=`‡∏û‡∏ö ${data.length} ‡∏Ç‡πà‡∏≤‡∏ß`;
}
function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); }; }
document.getElementById('newsSearch').addEventListener('input', debounce(e=>{ _newsQuery=e.target.value.trim(); renderNewsPage(1); },200));
async function loadFruitsNews(){
  const queries=['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏Ç‡πà‡∏≤‡∏ß ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ','‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î ‡∏Ç‡πà‡∏≤‡∏ß ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ','‡πÄ‡∏á‡∏≤‡∏∞ ‡∏Ç‡πà‡∏≤‡∏ß ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ'];
  const arr=(await Promise.all(queries.map(q=>fetchNewsTop(q,12)))).flat();
  _newsAll=arr; renderNewsPage(1); return arr;
}

/* ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏•‡πÑ‡∏°‡πâ */
const FRUITS=['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô','‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î','‡πÄ‡∏á‡∏≤‡∏∞'];
function estimatePricesFromNews(items){
  const map={‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:null,‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î:null,‡πÄ‡∏á‡∏≤‡∏∞:null}; const re=/(\d{2,4})\s*‡∏ö‡∏≤‡∏ó/;
  items.forEach(it=>{ FRUITS.forEach(f=>{ if(it.title.includes(f)){ const m=it.title.match(re)||(it.desc||'').match(re); const v=m?Number(m[1]):null; if(v && !map[f]) map[f]=v; } }); });
  const saved=JSON.parse(localStorage.getItem('FRUIT_PRICE_MAP')||'{}'); FRUITS.forEach(f=>{ if(saved[f]) map[f]=saved[f]; }); return map;
}
function renderPriceTable(pmap){
  const table=document.getElementById('priceTable'); table.innerHTML='';
  FRUITS.forEach(f=>{
    const val=pmap[f]?`${pmap[f]} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.`:'<span class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î</span>';
    table.insertAdjacentHTML('beforeend', `<div class="tr"><div><b>${f}</b><span class="chip" style="margin-left:8px">‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏´‡∏•‡∏±‡∏Å</span></div><div>${val}</div><div style="text-align:right"><button class="btn-link" onclick="editPrice('${f}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏Ñ‡∏≤</button></div></div>`);
  });
}
function editPrice(fruit){
  const current=prompt(`‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤ ${fruit} (‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.)`,''); if(current===null) return;
  const val=Number(current); if(!val){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç'); return;}
  const saved=JSON.parse(localStorage.getItem('FRUIT_PRICE_MAP')||'{}'); saved[fruit]=val; localStorage.setItem('FRUIT_PRICE_MAP',JSON.stringify(saved)); renderPriceTable(saved);
}
function addPrice(){
  const n=document.getElementById('pName').value.trim(), p=Number(document.getElementById('pPrice').value.trim());
  if(!n||!p) return; const saved=JSON.parse(localStorage.getItem('FRUIT_PRICE_MAP')||'{}'); saved[n]=p; localStorage.setItem('FRUIT_PRICE_MAP',JSON.stringify(saved));
  document.getElementById('pName').value=''; document.getElementById('pPrice').value='';
  document.getElementById('priceTable').insertAdjacentHTML('beforeend', `<div class="tr"><div><b>${n}</b></div><div>${p} ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.</div><div style="text-align:right"></div></div>`);
}

/* AI Summary */
function renderAI(text){
  const id='aiSummary'; const pretty=text.replace(/^[-*] /gm,'‚Ä¢ '); const preview=pretty.split('\n').slice(0,8).join('\n');
  document.getElementById('aiBox').innerHTML=`<div id="${id}-preview" class="clamp clamp-6" style="white-space:pre-wrap">${preview}</div>
    <div id="${id}-full" style="white-space:pre-wrap; display:none; margin-top:8px">${pretty}</div>
    <div style="margin-top:8px"><button class="btn-link" onclick="toggleSummary('${id}')">‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button></div>`;
}
function toggleSummary(id){
  const pv=document.getElementById(`${id}-preview`), full=document.getElementById(`${id}-full`);
  const show=full.style.display==='none'; full.style.display=show?'block':'none'; pv.style.display=show?'none':'block';
}

/* ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• + ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Ling-1T */
async function aggregateNow(){
  const token=readToken(); if(!token||!token.startsWith('hf_')) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å HF Token ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
  setLoading(true);
  try{
    const coords=await new Promise((res,rej)=>{ if(!navigator.geolocation) rej(new Error('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á')); navigator.geolocation.getCurrentPosition(p=>res(p.coords),e=>rej(e)); });
    const {latitude:lat, longitude:lon}=coords;
    const wx=await getWeatherByCoords(lat,lon);
    const province=await getProvinceTH(lat,lon);
    renderWeather(wx,province);
    const news=await loadFruitsNews();
    const priceMap=estimatePricesFromNews(news); renderPriceTable(priceMap);

    const payload={model:"inclusionAI/Ling-1T:featherless-ai",temperature:0.25,max_tokens:900,messages:[
      {role:"system",content:"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡πÑ‡∏ó‡∏¢ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏•‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÑ‡∏õ"},
      {role:"user",content:`‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏≤‡∏∞‡∏õ‡∏•‡∏π‡∏Å ‡∏ì ${province}

[‡∏≠‡∏≤‡∏Å‡∏≤‡∏®]
- ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: ${wx.temp}¬∞C
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${wx.rh}%
- ‡∏ù‡∏ô 3 ‡∏ä‡∏°.: ${wx.rain} ‡∏°‡∏°.
- ‡∏™‡∏†‡∏≤‡∏û: ${wx.desc}
- ‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏•‡πÑ‡∏ó‡∏¢: ${seasonTH(new Date().getMonth()+1)}

[‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î/‡πÄ‡∏á‡∏≤‡∏∞) ‚Äî ‡∏û‡∏≤‡∏î‡∏´‡∏±‡∏ß]
${news.slice(0,8).map((n,i)=>`- (${i+1}) ${n.title}`).join('\n') || '- (‡πÑ‡∏°‡πà‡∏°‡∏µ)'}

[‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô/‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å]
- ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${priceMap['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô']? priceMap['‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô']+' ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î'}
- ‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î: ${priceMap['‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î']? priceMap['‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î']+' ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î'}
- ‡πÄ‡∏á‡∏≤‡∏∞: ${priceMap['‡πÄ‡∏á‡∏≤‡∏∞']? priceMap['‡πÄ‡∏á‡∏≤‡∏∞']+' ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏Å.' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î'}

‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö:
- ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° 1‚Äì2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
- ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤ ‚Äú‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ‡∏ß‡πà‡∏≤‚Ä¶‚Äù ‡∏´‡∏£‡∏∑‡∏≠ ‚Äú‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‚Äù)
- ‡πÄ‡∏ä‡πá‡∏Å‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à 5‚Äì7 ‡∏Ç‡πâ‡∏≠
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á/‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á 3‚Äì4 ‡∏Ç‡πâ‡∏≠
- ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥/‡∏õ‡∏∏‡πã‡∏¢ (‡∏™‡∏±‡πâ‡∏ô 1 ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤)
- ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏¢‡πà‡∏≠ 3‚Äì5 ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏û‡∏≤‡∏î‡∏´‡∏±‡∏ß)`}
    ]};
    const resp=await fetch('https://router.huggingface.co/v1/chat/completions',{method:'POST',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!resp.ok) throw new Error(await resp.text());
    const data=await resp.json(); const text=data?.choices?.[0]?.message?.content?.trim()||'‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå';
    renderAI(text);
  }catch(e){
    document.getElementById('aiBox').innerHTML=`<div>‚ö†Ô∏è ${e.message}<br>‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏ô CORS ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô <code>python -m http.server 8080</code></div>`;
  }finally{ setLoading(false); }
}

/* initial */
document.getElementById('newsList').innerHTML='<div class="muted">‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</div>';
document.getElementById('priceTable').innerHTML='<div class="muted">‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‚Ä¶</div>';
</script>
</body>
</html>
