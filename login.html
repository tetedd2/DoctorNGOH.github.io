<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box} body{font-family:'Prompt',system-ui,sans-serif;background:#f5f7fb;margin:0}
    .card{max-width:560px;margin:24px auto;background:#fff;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08);padding:28px}
    h1{margin:0 0 6px} .muted{color:#6b7280;margin:0 0 16px}
    .row{display:flex;gap:12px;align-items:center;margin:12px 0}
    input{width:100%;padding:12px 14px;border:1px solid #d1d5db;border-radius:10px;font-size:16px}
    button{padding:12px 16px;border:0;border-radius:12px;font-weight:600;cursor:pointer}
    .btn{background:#2563eb;color:#fff} .btn.outline{background:#fff;color:#2563eb;border:2px solid #2563eb}
    .btn.google{background:#fff;border:1px solid #e5e7eb;color:#111}
    .foot{display:flex;gap:10px;flex-wrap:wrap}
    .err{background:#fde8e8;border:1px solid #f5c2c2;color:#b42318;padding:12px;border-radius:10px;margin-top:10px;display:none}
    .warn{display:none;background:#fff7e6;border:1px solid #ffe3a3;color:#8a6d1a;padding:10px;border-radius:10px;margin-top:8px}
    .link{color:#2563eb;cursor:pointer;text-decoration:underline}
  </style>
</head>
<body>
  <div class="card">
    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>
    <p class="muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ Home999</p>

    <div class="row">
      <button id="googleBtn" class="btn google" style="width:100%">üîπ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Google</button>
    </div>

    <div class="row"><div style="flex:1;height:1px;background:#e5e7eb"></div><div class="muted">‡∏´‡∏£‡∏∑‡∏≠</div><div style="flex:1;height:1px;background:#e5e7eb"></div></div>

    <div class="row"><input id="email" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"></div>
    <div class="row"><input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"></div>

    <div class="row foot">
      <button id="loginBtn" class="btn" style="flex:1">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</button>
      <button id="signupBtn" class="btn outline" style="flex:1">‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
      <button id="resetBtn" class="btn outline" style="flex:1">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    </div>

    <div id="inAppWarning" class="warn">
      ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô Chrome/Safari
      (Android: ‡πÄ‡∏°‡∏ô‡∏π ‚ãÆ ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Chrome, iOS: Share ‚Üí Open in Safari)
    </div>
    <div id="msg" class="err"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult,
      createUserWithEmailAndPassword, signInWithEmailAndPassword, fetchSignInMethodsForEmail,
      sendPasswordResetEmail, EmailAuthProvider, linkWithCredential
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    // ----- Firebase config (‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì) -----
    const firebaseConfig = {
      apiKey: "AIzaSyDq60nePWYn2AXt4gkJSqnTlpR84ZfkTUw",
      authDomain: "beneficial-applications.firebaseapp.com",
      projectId: "beneficial-applications",
      storageBucket: "beneficial-applications.firebasestorage.app",
      messagingSenderId: "614255728005",
      appId: "1:614255728005:web:69d167f6033ed3e452e0ec",
      measurementId: "G-N8RKQSHP94"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    auth.languageCode = 'th';
    const provider = new GoogleAuthProvider();

    // ---------- Utilities ----------
    const $ = (id)=>document.getElementById(id);
    function showErr(t){ const el=$('msg'); el.textContent=t; el.style.display='block'; }
    function clearErr(){ const el=$('msg'); el.style.display='none'; el.textContent=''; }
    function gotoHome(){ window.location.href = 'Home999.html'; }

    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô in-app browser (‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î disallowed_useragent)
    function isInAppBrowser(){
      const ua = navigator.userAgent || '';
      return /(FBAN|FBAV|Instagram|Line|LINE|Twitter|TikTok|WeChat|MicroMessenger|wv)/i.test(ua);
    }
    if(isInAppBrowser()){ $('inAppWarning').style.display='block'; }

    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

    // ---------- Email Login ----------
    $('loginBtn').addEventListener('click', async ()=>{
      clearErr();
      const email = $('email').value.trim();
      const pass  = $('password').value;
      if(!email || !pass){ showErr('‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'); return; }
      try{
        // ‡πÉ‡∏ä‡πâ signIn ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏´‡πâ‡∏≤‡∏° create ‡πÉ‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)
        await signInWithEmailAndPassword(auth, email, pass);
        gotoHome();
      }catch(e){
        // mapping ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢
        if(e.code==='auth/user-not-found'){ showErr('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î "‡∏™‡∏°‡∏±‡∏Ñ‡∏£" ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Google'); }
        else if(e.code==='auth/wrong-password' || e.code==='auth/invalid-credential'){ showErr('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); }
        else if(e.code==='auth/too-many-requests'){ showErr('‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà'); }
        else { showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`); console.error(e); }
      }
    });

    // ---------- Sign Up ----------
    $('signupBtn').addEventListener('click', async ()=>{
      clearErr();
      const email = $('email').value.trim();
      const pass  = $('password').value;
      if(!email || !pass){ showErr('‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'); return; }
      try{
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ß‡∏¥‡∏ò‡∏µ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const methods = await fetchSignInMethodsForEmail(auth, email);
        if(methods.length){
          // ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
          if(methods.includes('password')){
            showErr('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏ô‡∏π "‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"');
            return;
          }
          if(methods.includes('google.com')){
            showErr('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google"');
            return;
          }
        }
        await createUserWithEmailAndPassword(auth, email, pass);
        gotoHome();
      }catch(e){
        if(e.code==='auth/email-already-in-use'){
          showErr('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î "‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"');
        } else if(e.code==='auth/weak-password'){
          showErr('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏±‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)');
        } else{
          showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`); console.error(e);
        }
      }
    });

    // ---------- Reset Password ----------
    $('resetBtn').addEventListener('click', async ()=>{
      clearErr();
      const email = $('email').value.trim();
      if(!email){ showErr('‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô'); return; }
      try{
        await sendPasswordResetEmail(auth, email);
        alert('‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡πâ‡∏ß');
      }catch(e){
        if(e.code==='auth/user-not-found'){ showErr('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏•‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà'); }
        else{ showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`); console.error(e); }
      }
    });

    // ---------- Google Sign-in (popup ‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ / redirect ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ----------
    $('googleBtn').addEventListener('click', async ()=>{
      clearErr();
      if(isInAppBrowser()){ $('inAppWarning').scrollIntoView({behavior:'smooth'}); return; }
      try{
        if(isMobile) await signInWithRedirect(auth, provider);
        else await signInWithPopup(auth, provider);
      }catch(e){
        // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÅ‡∏ö‡∏ö password ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô ‚Üí ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•
        if(e.code==='auth/account-exists-with-different-credential'){
          const email = e.customData?.email;
          if(email){
            const methods = await fetchSignInMethodsForEmail(auth, email);
            showErr(`‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢: ${methods.join(', ')} ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö`);
          } else showErr('‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏≠‡∏∑‡πà‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
        } else {
          showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`); console.error(e);
        }
      }
    });

    // ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á redirect (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
    getRedirectResult(auth).then((res)=>{
      if(res?.user) gotoHome();
    }).catch(err=>console.error(err));

    // (‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÅ‡∏•‡πâ‡∏ß
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡∏Å Email/Password ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Google ‡πÄ‡∏î‡∏¥‡∏°
    async function addPasswordToGoogleUser(email, newPassword){
      const cred = EmailAuthProvider.credential(email, newPassword);
      await linkWithCredential(auth.currentUser, cred);
    }
  </script>
</body>
</html>
