<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box} body{font-family:'Prompt',system-ui,sans-serif;background:#f5f7fb;margin:0}
    .card{max-width:560px;margin:24px auto;background:#fff;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.08);padding:28px}
    h1{margin:0 0 6px} .muted{color:#6b7280;margin:0 0 16px}
    .row{display:flex;gap:12px;align-items:center;margin:12px 0}
    input{width:100%;padding:12px 14px;border:1px solid #d1d5db;border-radius:10px;font-size:16px}
    button{padding:12px 16px;border:0;border-radius:12px;font-weight:600;cursor:pointer}
    .btn{background:#2563eb;color:#fff} .btn.outline{background:#fff;color:#2563eb;border:2px solid #2563eb}
    .btn.google{background:#fff;border:1px solid #e5e7eb;color:#111}
    .foot{display:flex;gap:10px;flex-wrap:wrap}
    .err{background:#fde8e8;border:1px solid #f5c2c2;color:#b42318;padding:12px;border-radius:10px;margin-top:10px;display:none}
    .warn{display:none;background:#fff7e6;border:1px solid #ffe3a3;color:#8a6d1a;padding:10px;border-radius:10px;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>
    <p class="muted">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤ Home999</p>

    <div class="row">
      <button id="googleBtn" class="btn google" style="width:100%">üîπ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Google</button>
    </div>

    <div class="row"><div style="flex:1;height:1px;background:#e5e7eb"></div><div class="muted">‡∏´‡∏£‡∏∑‡∏≠</div><div style="flex:1;height:1px;background:#e5e7eb"></div></div>

    <div class="row"><input id="email" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"></div>
    <div class="row"><input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"></div>

    <div class="row foot">
      <button id="loginBtn" class="btn" style="flex:1">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</button>
      <button id="signupBtn" class="btn outline" style="flex:1">‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
      <button id="resetBtn" class="btn outline" style="flex:1">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    </div>

    <div id="inAppWarning" class="warn">
      ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô Chrome/Safari
      (Android: ‚ãÆ ‚Üí ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Chrome‚Äù, iOS: Share ‚Üí ‚ÄúOpen in Safari‚Äù)
    </div>
    <div id="msg" class="err"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult,
      createUserWithEmailAndPassword, signInWithEmailAndPassword, fetchSignInMethodsForEmail,
      sendPasswordResetEmail, EmailAuthProvider, linkWithCredential
    } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    // ---- Firebase config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÉ‡∏ä‡πâ‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°) ----
    const firebaseConfig = {
      apiKey: "AIzaSyDq60nePWYn2AXt4gkJSqnTlpR84ZfkTUw",
      authDomain: "beneficial-applications.firebaseapp.com",
      projectId: "beneficial-applications",
      storageBucket: "beneficial-applications.firebasestorage.app",
      messagingSenderId: "614255728005",
      appId: "1:614255728005:web:69d167f6033ed3e452e0ec",
      measurementId: "G-N8RKQSHP94"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    auth.languageCode = 'th';
    const provider = new GoogleAuthProvider();

    // ---------- Helpers ----------
    const $ = (id)=>document.getElementById(id);
    const showErr = (t)=>{ const el=$('msg'); el.textContent=t; el.style.display='block'; };
    const clearErr = ()=>{ const el=$('msg'); el.style.display='none'; el.textContent=''; };
    const gotoHome = ()=>{ window.location.href='Home999.html'; };

    // In-app browser detection (LINE/FB/IG/TikTok ‡∏Ø‡∏•‡∏Ø)
    function isInAppBrowser(){
      const ua = navigator.userAgent || '';
      return /(FBAN|FBAV|Instagram|Line|LINE|Twitter|TikTok|WeChat|MicroMessenger|wv)/i.test(ua);
    }
    if (isInAppBrowser()) $('inAppWarning').style.display = 'block';

    // ---------- Email/Password ----------
    $('loginBtn').addEventListener('click', async ()=>{
      clearErr();
      const email = $('email').value.trim();
      const pass  = $('password').value;
      if(!email || !pass){ showErr('‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'); return; }
      try{
        await signInWithEmailAndPassword(auth, email, pass);
        gotoHome();
      }catch(e){
        if(e.code==='auth/user-not-found') showErr('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î "‡∏™‡∏°‡∏±‡∏Ñ‡∏£" ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Google');
        else if(e.code==='auth/wrong-password'||e.code==='auth/invalid-credential') showErr('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        else if(e.code==='auth/too-many-requests') showErr('‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà');
        else showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`);
        console.error(e);
      }
    });

    $('signupBtn').addEventListener('click', async ()=>{
      clearErr();
      const email = $('email').value.trim();
      const pass  = $('password').value;
      if(!email || !pass){ showErr('‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô'); return; }
      try{
        const methods = await fetchSignInMethodsForEmail(auth, email);
        if(methods.includes('password')){ showErr('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"'); return; }
        if(methods.includes('google.com')){ showErr('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Google'); return; }
        await createUserWithEmailAndPassword(auth, email, pass);
        gotoHome();
      }catch(e){
        if(e.code==='auth/email-already-in-use') showErr('‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
        else if(e.code==='auth/weak-password') showErr('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
        else showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`);
        console.error(e);
      }
    });

    $('resetBtn').addEventListener('click', async ()=>{
      clearErr();
      const email = $('email').value.trim();
      if(!email){ showErr('‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô'); return; }
      try{
        await sendPasswordResetEmail(auth, email);
        alert('‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡πâ‡∏ß');
      }catch(e){
        if(e.code==='auth/user-not-found') showErr('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏•‡∏≠‡∏á‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà');
        else showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`);
        console.error(e);
      }
    });

    // ---------- Google Sign-in: ‡πÉ‡∏ä‡πâ "redirect" ‡πÄ‡∏™‡∏°‡∏≠ ----------
    $('googleBtn').addEventListener('click', async ()=>{
      clearErr();
      if (isInAppBrowser()){ $('inAppWarning').scrollIntoView({behavior:'smooth'}); return; }
      try{
        await signInWithRedirect(auth, provider);   // ‡πÉ‡∏ä‡πâ redirect ‡∏ï‡∏•‡∏≠‡∏î = ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏Å‡∏ß‡πà‡∏≤‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠/‡∏ö‡∏•‡πá‡∏≠‡∏Å popup
      }catch(e){
        if(e.code==='auth/unauthorized-domain'){
          showErr('‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô Firebase ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains');
        }else if(e.code==='auth/account-exists-with-different-credential'){
          const email = e.customData?.email;
          const methods = email ? await fetchSignInMethodsForEmail(auth, email) : [];
          showErr(`‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏ß‡∏¢: ${methods.join(', ')||'‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏∑‡πà‡∏ô'} ‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö`);
        }else{
          showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.code}`);
        }
        console.error(e);
      }
    });

    // ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏á redirect
    getRedirectResult(auth)
      .then((res)=>{ if(res?.user) gotoHome(); })
      .catch((err)=>{ console.error(err); showErr(`‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.code||err.message}`); });

    // (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å) ‡∏ú‡∏π‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ Google ‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
    async function addPasswordToGoogleUser(email, newPassword){
      const cred = EmailAuthProvider.credential(email, newPassword);
      await linkWithCredential(auth.currentUser, cred);
    }
  </script>
</body>
</html>
